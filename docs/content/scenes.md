# 场景设计

本文档定义场景系统的设计规则。数据结构参考 [../data/schema.md](../data/schema.md)。

## 场景基本信息

1. **场景名字** - 如"权力的游戏"、"书店营业"、"装备商人"
2. **场景剩余回合** - 显示在场景标识上
3. **场景背景** - 详细的场景描述文本
4. **场景内容** - 可以根据宫廷中【支持】与【反对】的数量来决定游戏进程

### 支持与反对

- **数值来源**：人物卡的 `special_attributes.support`
- **判定规则**：`support >= 0` 为支持，`support < 0` 为反对
- **汇总方式**：与其他属性检定相同，由场景的 `calc_mode` 决定（求和/最大值/最小值等）
- **影响**：影响特定宫廷场景的分支走向

---

## 卡槽系统

### 卡槽分类

**按锁定方式**：
- **锁定型卡槽**：自动获取卡片，不能手工置入
- **开放型卡槽**：可以手动放置卡片

**按必填要求**：
- **必选卡槽**：用红色标识，必须填入才能参与
- **开放卡槽**：用白色标识，可选填入

### 卡槽类型

| 类型 | key | 说明 |
|------|-----|------|
| 人物卡槽 | `character` | 放置人物卡 |
| 物品卡槽 | `item` | 放置物品卡 |
| 苏丹卡槽 | `sultan` | 放置苏丹卡 |
| 金币卡槽 | `gold` | 用于购买交易 |

---

## 场景类型

| 类型 | key | 说明 |
|------|-----|------|
| 事件决策场景 | `event` | 多角色展示 + 分支选项 |
| 商店场景 | `shop` | 商品展示 + 购买交互，支持一次购买多件物品 |
| 检定挑战场景 | `challenge` | 纯检定场景 |

### 商店场景特点

- **即时结算**：duration = 1，当天参与当天结算
- **无检定**：不需要属性检定，纯交易行为
- **双向交易**：可购买商品，也可出售手牌
- **定期刷新**：每7天商品库存刷新
- **无缺席惩罚**：不参与不会有负面后果

---

## 场景状态

| 状态 | key | 说明 |
|------|-----|------|
| 可用 | `available` | 显示在地图上，可以参与 |
| 已参与 | `participated` | 玩家已投入卡片，等待结算 |
| 结算中 | `settling` | 正在进行结算流程 |
| 已完成 | `completed` | 结算完毕，即将移除或重置 |
| 锁定 | `locked` | 暂时不可参与（前置条件未满足） |

---

## 场景参与流程

1. **选择场景**：点击地图上的场景节点
2. **查看需求**：显示场景所需的卡槽类型和数量
3. **投入卡片**：
   - 必选卡槽（红色）：必须填入对应卡片才能参与
   - 开放卡槽（白色）：可选填入，增加成功率或获得额外奖励
4. **确认参与**：点击确认按钮，锁定参与
5. **等待结算**：场景回合数每天 -1，归零时结算

---

## 卡牌锁定规则

- **锁定时机**：玩家点击"确认参与"后，该场景所有已投入卡进入锁定状态
- **锁定限制**：锁定卡不可用于其他场景、不可丢弃、不可出售、不可装备/卸下
- **解锁时机**：场景结算完成后，未被消耗/移除的卡解除锁定回到玩家可用区
- **资源即限制**：玩家拥有的卡牌数量决定同时参与场景的能力上限

---

## 多场景参与规则

- 同一张卡片同一时间只能投入一个场景

---

## 场景交互机制

- **拖放系统**：将金币/物品拖放到对应槽位完成交易
- **选择系统**：通过点击选项或填充槽位来确认操作
- **多重确认**：操作后需点击确认按钮才能生效

---

## 示例图

![scene01](../images/scene01.PNG)
![scene02](../images/scene02.PNG)
![scene03](../images/scene03.PNG)
